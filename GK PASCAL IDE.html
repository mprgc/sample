<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pascal Web Editor & Runner</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e1e1e;
            color: #ffffff;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Top Navigation Bar */
        .navbar {
            background-color: #333;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #444;
            position: relative;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            font-weight: bold;
            color: #00bcd4;
            font-size: 1.2rem;
        }

        .menu-icon {
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 5px;
        }

        .menu-icon div {
            width: 20px;
            height: 2px;
            background-color: white;
            transition: 0.3s;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Toolbar Buttons */
        .btn {
            border: none;
            padding: 8px 15px;
            font-size: 14px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
            color: white;
        }

        .btn-open { background-color: #607d8b; }
        .btn-open:hover { background-color: #546e7a; }

        .btn-save { background-color: #ff9800; }
        .btn-save:hover { background-color: #f57c00; }

        .btn-clear { background-color: #f44336; }
        .btn-clear:hover { background-color: #d32f2f; }

        .run-btn {
            background-color: #4caf50;
            padding: 8px 25px;
            font-size: 16px;
        }
        .run-btn:hover { background-color: #45a049; }

        /* Workspace Layout */
        .workspace {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #333;
            overflow: hidden;
        }

        .tab-bar {
            background-color: #252526;
            padding: 8px 15px;
            font-size: 13px;
            color: #aaa;
            border-bottom: 1px solid #1e1e1e;
        }

        .editor-wrapper {
            flex: 1;
            display: flex;
            background-color: #1e1e1e;
            overflow: hidden;
        }

        .line-numbers {
            width: 45px;
            background-color: #1e1e1e;
            color: #858585;
            padding: 20px 5px;
            text-align: right;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 16px;
            line-height: 1.5;
            user-select: none;
            border-right: 1px solid #333;
            overflow: hidden;
        }

        #code-editor {
            flex: 1;
            background-color: #1e1e1e;
            color: #d4d4d4;
            border: none;
            padding: 20px 15px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 16px;
            resize: none;
            outline: none;
            line-height: 1.5;
            white-space: pre;
            overflow: auto;
        }

        /* Terminal Section */
        .terminal-container {
            width: 40%;
            background-color: #000;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .terminal-header {
            background-color: #333;
            color: #ddd;
            padding: 8px 15px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #terminal-output {
            flex: 1;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            color: #00ff00; 
            overflow-y: auto;
            white-space: pre-wrap;
            outline: none;
        }

        /* Hidden input for terminal interaction */
        #terminal-input-hidden {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        /* About Us Overlay */
        #about-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .about-content {
            background-color: #252526;
            padding: 35px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            border: 1px solid #444;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
        }

        .about-content h1 { color: #00bcd4; margin-top: 0; }
        .about-content p { line-height: 1.7; color: #cccccc; margin: 15px 0; }
        
        .close-btn {
            margin-top: 25px;
            background-color: #00bcd4;
            color: #1e1e1e;
            border: none;
            padding: 10px 30px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 15px;
            background-color: #00ff00;
            animation: blink 1s infinite;
            vertical-align: middle;
        }

        @keyframes blink { 50% { opacity: 0; } }

        /* Mobile Adjustments */
        .mobile-tabs {
            display: none;
            background-color: #252526;
            border-bottom: 1px solid #333;
        }

        .mobile-tabs button {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            border-bottom: 2px solid transparent;
        }

        .mobile-tabs button.active {
            color: #00bcd4;
            border-bottom: 2px solid #00bcd4;
            background-color: #2d2d30;
        }

        @media (max-width: 900px) {
            .mobile-tabs { display: flex; }
            .workspace { position: relative; }
            .editor-container, .terminal-container {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border-right: none;
                display: none;
            }
            .editor-container.active, .terminal-container.active {
                display: flex;
            }
            
            /* Mobile button behavior: Hide text for some buttons */
            .btn span {
                display: none;
            }
            .run-btn span {
                display: inline; /* Keep text for RUN button */
            }
            .btn {
                padding: 8px 12px;
            }
            .logo {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <input type="file" id="file-input" style="display: none;" accept=".pas,.txt" onchange="handleFileSelect(event)">

    <div id="about-overlay" onclick="toggleAbout(event)">
        <div class="about-content" onclick="event.stopPropagation()">
            <h1>‡∂Ö‡∂¥ ‡∂¥‡∑í‡∑Ö‡∑í‡∂∂‡∂≥‡∑Ä</h1>
            <p>GK PASCAL IDE ‡∂∫‡∂±‡∑î Pascal ‡∂∑‡∑è‡∑Ç‡∑è‡∑Ä ‡∑Ñ‡∂Ø‡∑è‡∂ª‡∂± ‡∑É‡∑í‡∑É‡∑î‡∂±‡∑ä ‡∑Ä‡∑ô‡∂±‡∑î‡∑Ä‡∑ô‡∂±‡∑ä ‡∂±‡∑í‡∂ª‡∑ä‡∂∏‡∑è‡∂´‡∂∫ ‡∂ö‡∂ª‡∂± ‡∂Ω‡∂Ø ‡∑É‡∑ê‡∑Ñ‡∑ê‡∂Ω‡∑ä‡∂Ω‡∑î ‡∑Ä‡∑ô‡∂∂‡∑ä ‡∂∏‡∑ô‡∑Ä‡∂Ω‡∂∏‡∂ö‡∑í.</p>
            <div style="font-size: 13px; color: #777; margin-top: 20px;">
                Version 2.7 | Developer: GK Team<br>
                ¬© 2026 ‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∑Ñ‡∑í‡∂∏‡∑í‡∂ö‡∂∏‡∑ä ‡∂á‡∑Ä‡∑í‡∂ª‡∑í‡∂´‡∑í.
            </div>
            <button class="close-btn" onclick="toggleAbout()">‡∑Ä‡∑É‡∑è ‡∂Ø‡∂∏‡∂±‡∑ä‡∂±</button>
        </div>
    </div>

    <div class="navbar">
        <div class="nav-left">
            <div class="menu-icon" onclick="toggleAbout()">
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="logo">GK PASCAL IDE</div>
        </div>
        
        <div class="nav-right">
            <button class="btn btn-open" onclick="document.getElementById('file-input').click()">üìÇ <span>Open</span></button>
            <button class="btn btn-save" onclick="saveCode()">üíæ <span>Save</span></button>
            <button class="btn btn-clear" onclick="clearCode()">üóëÔ∏è <span>Clear</span></button>
            <button class="btn run-btn" onclick="executePascal()">‚ñ∂ <span>RUN</span></button>
        </div>
    </div>

    <div class="mobile-tabs">
        <button id="tab-editor-btn" class="active" onclick="switchTab('editor')">main.pas</button>
        <button id="tab-terminal-btn" onclick="switchTab('terminal')">Output</button>
    </div>

    <div class="workspace">
        <div id="editor-view" class="editor-container active">
            <div class="tab-bar">main.pas</div>
            <div class="editor-wrapper">
                <div id="line-numbers" class="line-numbers">1</div>
                <textarea id="code-editor" spellcheck="false"></textarea>
            </div>
        </div>

        <div id="terminal-view" class="terminal-container">
            <div class="terminal-header">Terminal Output</div>
            <div id="terminal-output" tabindex="0">C:\Users\Pascal\Documents> <span class="cursor"></span></div>
            <input type="text" id="terminal-input-hidden">
        </div>
    </div>

    <script>
        const editor = document.getElementById('code-editor');
        const lineNumbers = document.getElementById('line-numbers');
        const terminalOutput = document.getElementById('terminal-output');
        const hiddenInput = document.getElementById('terminal-input-hidden');

        let isWaitingForInput = false;
        let inputResolver = null;
        let currentInputBuffer = "";

        const defaultCode = "program Calc;\nvar x, y, sum : integer;\nbegin\n  write('Enter first number : ');\n  readln(x);\n  write('Enter second number : ');\n  readln(y);\n  sum := x + y;\n  writeln('Sum = ', sum);\nend.";

        function updateLineNumbers() {
            const lines = editor.value.split('\n');
            let displayNumbers = '';
            for (let i = 1; i <= lines.length; i++) {
                displayNumbers += i + '\n';
            }
            lineNumbers.innerText = displayNumbers;
        }

        window.onload = function() {
            editor.value = defaultCode;
            updateLineNumbers();
        };

        editor.addEventListener('scroll', () => { lineNumbers.scrollTop = editor.scrollTop; });
        editor.addEventListener('input', updateLineNumbers);

        // Terminal Input Handling
        terminalOutput.addEventListener('click', () => {
            if (isWaitingForInput) hiddenInput.focus();
        });

        hiddenInput.addEventListener('input', (e) => {
            if (!isWaitingForInput) return;
            currentInputBuffer = hiddenInput.value;
            renderTerminalWithInput();
        });

        hiddenInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && isWaitingForInput) {
                const value = hiddenInput.value;
                isWaitingForInput = false;
                hiddenInput.value = "";
                currentInputBuffer = "";
                
                // Replace cursor with the finalized input and a newline
                const cursorHtml = '<span class="cursor"></span>';
                terminalOutput.innerHTML = terminalOutput.innerHTML.replace(cursorHtml, value + "\n" + cursorHtml);
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
                
                if (inputResolver) inputResolver(value);
            }
        });

        function renderTerminalWithInput() {
            const baseText = terminalOutput.dataset.baseText || "";
            const cursorHtml = '<span class="cursor"></span>';
            terminalOutput.innerHTML = baseText + currentInputBuffer + cursorHtml;
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }

        async function getTerminalInput() {
            isWaitingForInput = true;
            currentInputBuffer = "";
            hiddenInput.value = "";
            // Store the current terminal state without the cursor as the base for real-time typing
            terminalOutput.dataset.baseText = terminalOutput.innerHTML.replace('<span class="cursor"></span>', '');
            renderTerminalWithInput();
            hiddenInput.focus();
            
            return new Promise((resolve) => {
                inputResolver = resolve;
            });
        }

        function toggleAbout() {
            const overlay = document.getElementById('about-overlay');
            overlay.style.display = (overlay.style.display === 'flex') ? 'none' : 'flex';
        }

        function switchTab(tab) {
            document.getElementById('editor-view').classList.toggle('active', tab === 'editor');
            document.getElementById('terminal-view').classList.toggle('active', tab === 'terminal');
            document.getElementById('tab-editor-btn').classList.toggle('active', tab === 'editor');
            document.getElementById('tab-terminal-btn').classList.toggle('active', tab === 'terminal');
        }

        function clearCode() {
            if (confirm("‡∂ö‡∑ö‡∂≠‡∂∫ ‡∂∏‡∂ö‡∑è ‡∂Ø‡∑ê‡∂∏‡∑ì‡∂∏‡∂ß ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫‡∂Ø?")) {
                editor.value = "";
                updateLineNumbers();
            }
        }

        function saveCode() {
            const blob = new Blob([editor.value], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'program.pas';
            a.click();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                editor.value = e.target.result;
                updateLineNumbers();
            };
            reader.readAsText(file);
        }

        async function executePascal() {
            const fullCode = editor.value;
            const output = document.getElementById('terminal-output');
            const cursorHtml = '<span class="cursor"></span>';
            
            if (window.innerWidth <= 900) switchTab('terminal');
            
            output.innerHTML = "Compiling...\n------------------------------\n" + cursorHtml;

            await new Promise(r => setTimeout(r, 400));

            const codeLines = fullCode.split('\n');
            let variables = {};
            let hasError = false;

            for (let i = 0; i < codeLines.length; i++) {
                let line = codeLines[i].trim();
                let lineNumber = i + 1;

                if (!line || 
                    line.toLowerCase().startsWith('program') || 
                    line.toLowerCase().startsWith('var') ||
                    line.toLowerCase() === 'begin' || 
                    line.toLowerCase() === 'end.') continue;

                try {
                    let processingLine = line.endsWith(';') ? line.slice(0, -1).trim() : line;

                    // Case: read/readln
                    let readMatch = processingLine.match(/read(ln)?\s*\((.*)\)/i);
                    if (readMatch) {
                        let varNames = readMatch[2].split(',').map(v => v.trim());
                        for (let vName of varNames) {
                            let userInput = await getTerminalInput();
                            variables[vName] = isNaN(userInput) || userInput === "" ? userInput : Number(userInput);
                        }
                        continue;
                    }

                    // Case: write/writeln
                    let writeMatch = processingLine.match(/write(ln)?\s*\((.*)\)/i);
                    if (writeMatch) {
                        let content = writeMatch[2].trim();
                        let parts = content.split(/,(?=(?:(?:[^']*'){2})*[^']*$)/);
                        let outputLine = "";

                        parts.forEach(part => {
                            part = part.trim();
                            if (part.startsWith("'") && part.endsWith("'")) {
                                outputLine += part.slice(1, -1);
                            } else if (variables[part] !== undefined) {
                                outputLine += variables[part];
                            } else {
                                try {
                                    let tempExpr = part;
                                    Object.keys(variables).forEach(v => {
                                        tempExpr = tempExpr.replace(new RegExp('\\b' + v + '\\b', 'g'), variables[v]);
                                    });
                                    outputLine += eval(tempExpr);
                                } catch(err) {
                                    if(isNaN(part)) throw new Error("Undefined");
                                    outputLine += part;
                                }
                            }
                        });
                        
                        const suffix = writeMatch[1] ? "\n" : "";
                        output.innerHTML = output.innerHTML.replace(cursorHtml, outputLine + suffix + cursorHtml);
                        output.scrollTop = output.scrollHeight;
                        continue;
                    }

                    // Case: Assignment
                    let assignMatch = processingLine.match(/^(\w+)\s*:=\s*(.+)$/);
                    if (assignMatch) {
                        let varName = assignMatch[1].trim();
                        let expression = assignMatch[2].trim();
                        
                        Object.keys(variables).forEach(v => {
                            expression = expression.replace(new RegExp('\\b' + v + '\\b', 'g'), variables[v]);
                        });

                        let jsExpr = expression.replace(/'/g, '"');
                        variables[varName] = eval(jsExpr);
                        continue;
                    }

                    if (line && !line.startsWith('//') && line.toLowerCase() !== 'begin') {
                        throw new Error("Syntax");
                    }

                } catch (e) {
                    console.error(e);
                    output.innerHTML = output.innerHTML.replace(cursorHtml, `<span style="color: #ff5555;">‡∂Ø‡∑ù‡∑Ç‡∂∫‡∂ö‡∑í: Pascal ‡∂ö‡∑ö‡∂≠‡∂∫‡∑ö ‡∑Ä‡∑ê‡∂ª‡∑ê‡∂Ø‡∑ä‡∂Ø‡∂ö‡∑ä ‡∂¥‡∑Ä‡∂≠‡∑ì.\n‡∂¥‡∑ö‡∑Ö‡∑í ‡∂Ö‡∂Ç‡∂ö‡∂∫: ${lineNumber}</span>\n\nC:\\Users\\Pascal\\Documents> ` + cursorHtml);
                    hasError = true;
                    break;
                }
            }

            if (!hasError) {
                output.innerHTML = output.innerHTML.replace(cursorHtml, "\n------------------------------\nC:\\Users\\Pascal\\Documents> " + cursorHtml);
                output.scrollTop = output.scrollHeight;
            }
        }
    </script>
</body>
</html>